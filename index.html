<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="png" href="images/icon/favicon.png" />
    <title>User Section Page</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }
      nav {
        background-color: #333;
        padding: 15px;
        color: white;
      }
      nav select,
      nav button {
        margin-right: 10px;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
      }
      nav button {
        background-color: #4caf50;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      nav button:hover {
        background-color: #45a049;
      }
      .card-container {
        margin-top: 10vh;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 20px;
      }
      .card {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        width: 250px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 30px;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
      }
      .close:hover {
        color: #000;
      }
      form {
        display: grid;
        gap: 15px;
      }
      form input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      form button {
        padding: 12px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }
      form button:hover {
        background-color: #45a049;
      }
      h2 {
        color: #333;
        margin-bottom: 20px;
      }

      .nav {
        width: 100%;
        background-color: #fff;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        padding: 20px 2%;
        position: fixed;
        top: 0px;
        z-index: 10;
        box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.5);
      }

      .nav li,
      a,
      button {
        float: left;
        font-family: "Montserrat", sans-serif;
        font-weight: 500;
        font-size: 13px;
        color: #2e3d49;
        display: block;
        text-decoration: none;
        text-align: center;
      }

      .nav ul li img {
        width: 20px;
        margin-right: 10px;
        transform: translateY(5px);
        padding-top: 5px;
      }

      .nav ul li {
        list-style: none;
        display: inline-block;
        padding: 0px 20px;
      }

      .nav ul li a {
        transition: all 0.3s ease 0s;
      }

      .nav ul li a:hover {
        color: #fa4b37;
      }

      .nav button {
        padding: 9px 25px;
        background: linear-gradient(to right, #fa4b37, #df2771);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        outline: none;
        transition: all 0.3s ease 0s;
      }
      .nav button:hover {
        opacity: 0.9;
      }
      .nav .search {
        float: right;
      }
      .nav .search .srch {
        font-size: 13px;
        width: 300px;
        border: none;
        outline: none;
        border-bottom: 2px solid #fa4b37;
        padding: 9px;
      }
      .nav .search button {
        margin-right: 5px;
        float: right;
        margin-left: 10px;
      }
      .nav .switch-tab {
        cursor: pointer;
        visibility: hidden;
      }
      .nav .switch-tab img {
        width: 20px;
      }
      .nav .check-box {
        cursor: pointer;
        visibility: hidden;
      }

      /*TITLE*/
      .title {
        margin-top: 100px;
        margin-left: 100px;
      }
      .title span {
        font-weight: 700;
        font-family: "Open Sans", sans-serif;
        font-size: 60px;
        color: #2e3d49;
      }
      .title .shortdesc {
        padding: 10px;
        font-family: "Open Sans", sans-serif;
        font-size: 20px;
        color: #2e3d49;
        margin-bottom: 50px;
      }

      /*Quick Links*/
      /*Footer*/

      footer {
        color: #e5e8ef;
        background: #000d;
        padding: 50px 0;
      }

      footer .footer-container {
        max-width: 1300px;
        margin: auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap-reverse;
      }

      footer .social-media img {
        width: 22px;
      }

      footer .logo {
        width: 180px;
        color: #fff;
        font-family: "Montserrat", cursive;
      }
      footer .social-media {
        margin: 20px 0;
      }

      footer .social-media a {
        color: #001a21;
        margin-right: 10px;
        font-size: 22px;
        text-decoration: none;
      }

      footer .right-col h1 {
        font-size: 26px;
      }
      footer .border {
        width: 100px;
        height: 4px;
        background: linear-gradient(to right, #fa4b37, #df2771);
        margin: 2px;
      }

      footer .newsletter-form {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
      }
      footer input::placeholder {
        color: white !important;
      }
      footer .txtb {
        flex: 1;
        padding: 18px 40px;
        font-size: 16px;
        background: #343a40;
        border: none;
        font-weight: 700;
        outline: none;
        border-radius: 5px;
        min-width: 260px;
        margin-top: 20px;
        color: white;
      }

      footer .btn {
        margin-top: 20px;
        padding: 18px 40px;
        font-size: 16px;
        color: #f1f1f1;
        background: linear-gradient(to right, #fa4b37, #df2771);
        border: none;
        font-weight: 700;
        outline: none;
        border-radius: 5px;
        margin-left: 20px;
        cursor: pointer;
        transition: opacity 0.3s linear;
      }

      footer .btn:hover {
        opacity: 0.7;
      }

      /*For Responsive Website*/
      @media screen and (max-width: 960px) {
        .footer-container {
          max-width: 600px;
        }
        .right-col {
          width: 100%;
          margin-bottom: 60px;
        }
        .left-col {
          width: 100%;
          text-align: center;
        }
        .social-media {
          display: flex;
          justify-content: center;
        }
      }

      @media screen and (max-width: 700px) {
        footer .btn {
          margin: 0;
          width: 100%;
          margin-top: 20px;
        }
      }
      @media screen and (max-width: 1366px) {
        .search {
          display: none;
          margin-bottom: 10px;
        }
      }

      @media screen and (max-width: 1000px) {
        .nav ul,
        .nav .search {
          display: none;
        }
        .nav #learned-logo {
          transition: 1s ease;
          margin-left: 40%;
          transform: scale(1.5);
        }
        .nav ul li {
          width: 100%;
          margin-bottom: 5px;
        }
        .nav .switch-tab {
          visibility: visible;
        }
        .nav .check-box {
          visibility: visible;
        }
        .search {
          visibility: visible;
          margin: 30px;
          margin-top: 0px;
        }
      }
      .black {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }
      nav {
        padding-top: 10px;
        padding-bottom: 10px;
        top: 0;
        position: fixed;
        display: flex;
        width: 100%;
        z-index: 1000;
        background: #fff;
        justify-content: space-between;
        transition: 1.5s;
        align-items: center;
      }
      .nav-left {
        display: flex;
      }
      nav ul {
        display: flex;
        align-items: center;
      }
      nav ul li {
        list-style: none;
        margin: 5px 10px;
      }
      nav ul li a {
        padding: 2px 10px;
        color: #2e2e2e;
        cursor: pointer;
        transition: 0.5s;
        text-decoration: none;
      }
      nav ul li a:hover {
        color: #fff;
        border-radius: 5px;
        background: #df2771;
      }
      .active {
        color: #fff;
        border-radius: 5px;
        background: #df2771;
      }
      .srch {
        padding: 2px 10px;
        display: flex;
        /* align-items: center; */
        justify-content: center;
        /* background: #0066ff; */
        border: 1px solid;
        border-radius: 20px;
      }
      .srch img {
        width: 25px;
        cursor: pointer;
      }
      .srch .search {
        /* padding: 2px 10px; */
        outline: none;
        border: none;
        background: transparent;
      }

      .get-started {
        margin-left: 50px;
        padding: 5px 20px;
        border: 2px solid #df2771;
        border-radius: 20px;
        text-decoration: none;

        transition: 0.5s;
        background-color: #df2771;
        color: #fff;
      }
      .get-started:hover {
        color: #2e2e2e;
        background: #fff;
      }
      .logo img {
        width: 120px;
        cursor: pointer;
        transition: all 1s;
      }

      a,
      button {
        float: left;
        font-family: "Montserrat", sans-serif;
        font-weight: 500;
        font-size: 15px;
        color: #2e3d49;
        display: block;
        text-decoration: none;
        text-align: center;
      }
      .head-container {
        margin-top: 245px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-around;
      }

      .menu {
        cursor: pointer;
        width: 25px;
        display: none;
      }
      .side-menu {
        width: 100%;
        /* height: 100%; */
        background: rgba(182, 33, 90, 0.993);
        position: absolute;
        top: 0;
        transition: 0.8s;
        z-index: 2000;
        /* display: none; */
        /* transform: translateX(-100%); */
      }
      .side-menu ul {
        /* margin-top: 35%; */
        display: flex;
        flex-direction: column;
        justify-content: center;
        /* background: rgba(182, 33, 90, 0.993); */
        /* background: #FA4B37; */
      }
      .side-menu ul li {
        list-style: none;
        /* background: #009900; */
        display: flex;
        justify-content: center;
        align-items: center;
        border-bottom: 1px solid #fff;
        padding: 10px 0px;
      }
      .side-menu ul li:hover a {
        background: #fff;
        color: #df2771;
      }
      .side-menu ul li a {
        color: #fff;
        width: 100%;
        font-size: 1em;
        /* background: #2E3D49; */
        text-decoration: none;
        padding: 15px 0px;
      }
      .close img {
        float: right;
        width: 35px;
        cursor: pointer;
        margin: 10px;
      }
      .hide {
        display: none;
      }

      /*PROPERTIES FOR MAKING WEBSITE RESPONSIVE*/
      @media screen and (max-width: 960px) {
        .kl {
          margin-top: 10vh;
        }
        .footer-container {
          max-width: 600px;
        }
        .right-col {
          width: 100%;
          margin-bottom: 60px;
        }
        .left-col {
          width: 100%;
          text-align: center;
        }
        .social-media {
          display: flex;
          justify-content: center;
        }
        .logo {
          transition: 1s;
          margin-left: 30%;
        }
        nav ul,
        .srch,
        .get-started {
          display: none;
        }
        .menu {
          display: block;
        }
        nav {
          padding-bottom: 20px;
          border-bottom: 1px solid #0005;
          /* position: fixed; */
          /* top: 0; */
        }
        .quote p,
        .quote h5,
        .play {
          justify-content: center;
          text-align: center;
        }
        .quote p {
          font-size: 30px;
        }
        .service-container .right-side img {
          width: 90%;
        }
        .title {
          margin-top: 0px;
        }
      }
      @media screen and (max-width: 700px) {
        footer .btn {
          margin: 0;
          width: 100%;
          margin-top: 20px;
        }
        .svg-image img {
          width: 90%;
          margin: 20px;
          /* align-self: center; */
        }
      }

      @media screen and (max-width: 1000px) {
        .feedbox form input,
        .feedbox form .fname {
          width: 100%;
        }
      }
      #sectionDropdown:hover {
        color: #fff;
        border-radius: 5px;
        background: #df2771;
      }
      .register {
        margin-right: 2%;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-left">
        <div class="logo">
          <a href="main.php"><img src="images/icon/logo.png" alt="logo" /></a>
        </div>
        <ul>
          <!-- <li><a class="active" href="">Home</a></li> -->
          <li><a href="main.php/#semester">Branch</a></li>
          <!-- <li><a href="#tools">AcademicAids</a></li> -->
          <li><a href="main.php/#services">AcademiaAccess</a></li>
          <li><a href="main.php/#footer">AcademiaCircle</a></li>
          <li><a href="main.php/Faculty_Review.html">FacultyReview</a></li>
        </ul>
      </div>
      <select id="sectionDropdown">
        <option value="">Select Section You Want To Swap With</option>
        <!-- Add your sections here -->
      </select>
      <button class="register" onclick="openRegisterModal()">Register</button>
    </nav>

    <div class="card-container" id="userCards"></div>

    <div id="registerModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeRegisterModal()">&times;</span>
        <h2>Register User</h2>
        <form id="registerForm">
          <input
            type="text"
            id="fullname"
            placeholder="Full Name"
            required
            maxlength="250"
          /><br />
          <input
            type="email"
            id="email"
            placeholder="KIIT Email"
            required
            maxlength="250"
          /><br />
          <input
            type="tel"
            id="phoneNumber"
            placeholder="Phone Number"
            required
            maxlength="250"
          /><br />
          <input
            type="text"
            id="haveSection"
            placeholder="Have Section(eg.- CSE1)"
            required
            maxlength="250"
          /><br />
          <input
            type="text"
            id="wantSection"
            placeholder="Want Section (comma-separated)(eg.- CSE1,CSE2,CSE3)"
            required
            maxlength="250"
          /><br />
          <button type="submit">Register</button>
        </form>
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div id="footer" class="footer-container">
        <div class="left-col">
          <img src="images/icon/logo.png" style="width: 200px" />
          <div class="logo"></div>
          <div class="social-media">
            <a href="#"><img src="images/icon\fb.png" /></a>
            <a href="#"><img src="images/icon\insta.png" /></a>
            <a href="#"><img src="images/icon\tt.png" /></a>
            <a href="#"><img src="images/icon\ytube.png" /></a>
            <a href="#"><img src="images/icon\linkedin.png" /></a>
          </div>
          <br /><br />
          <p class="rights-text">
            Copyright Â© 2024 Created By Kiit Wallah All Rights Reserved.
          </p>
          <br />
          <p>
            <img src="images/icon/location.png" /> Kalinga Institute of
            Industrial Technology<br />Bhubaneshwar, Odisha-751024
          </p>
          <br />
          <p>
            <img src="images/icon/phone.png" /> +91-1234-567-890<br /><img
              src="images/icon/mail.png"
            />&nbsp; kiitwallah@gmail.com
          </p>
        </div>
        <div class="right-col">
          <h1 style="color: #fff">Our Newsletter</h1>
          <div class="border"></div>
          <br />
          <p>Enter Your Email to get our News and updates.</p>
          <form class="newsletter-form" id="emailForm">
            <input
              class="txtb"
              id="emailInput"
              type="email"
              placeholder="Enter Your Email"
            />
            <input class="btn" type="submit" value="Submit" />
          </form>
        </div>
      </div>
    </footer>

    <script>
      const API_BASE_URL = "http://localhost:8000/api/v1/users"; // Replace with your actual API base URL

      async function fetchAllUsers() {
        try {
          const response = await fetch(`${API_BASE_URL}/`);
          if (!response.ok) throw new Error("Failed to fetch users");
          return await response.json();
        } catch (error) {
          console.error("Error:", error);
          return { data: [] };
        }
      }

      async function fetchUsersBySection(section) {
        try {
          const response = await fetch(`${API_BASE_URL}/section/${section}`);
          if (!response.ok) throw new Error("Failed to fetch users by section");
          return await response.json();
        } catch (error) {
          console.error("Error:", error);
          return { data: [] };
        }
      }

      function createUserCard(user) {
        return `
                <div class="card">
                    <h3>${user.fullname}</h3>
                    <p>Email: ${user.email}</p>
                    <p>Phone: ${user.phoneNumber}</p>
                    <p>Have Section: ${user.haveSection}</p>
                    <p>Want Section: ${user.wantSection.join(", ")}</p>
                </div>
            `;
      }

      async function displayUsers(users) {
        const container = document.getElementById("userCards");
        container.innerHTML = users.data.map(createUserCard).join("");
      }

      function populateSectionDropdown() {
        const dropdown = document.getElementById("sectionDropdown");
        const sections = ["CSE1", "CSE2", "CSE3", "CSE4"]; // Add or modify these sections as per your actual data

        sections.forEach((section) => {
          const option = document.createElement("option");
          option.value = section;
          option.textContent = `${section}`;
          dropdown.appendChild(option);
        });
      }

      async function loadInitialUsers() {
        const users = await fetchAllUsers();
        displayUsers(users);
      }

      document
        .getElementById("sectionDropdown")
        .addEventListener("change", async (event) => {
          const section = event.target.value;
          if (section) {
            const users = await fetchUsersBySection(section);
            displayUsers(users);
          } else {
            loadInitialUsers();
          }
        });

      function openRegisterModal() {
        document.getElementById("registerModal").style.display = "block";
      }

      function closeRegisterModal() {
        document.getElementById("registerModal").style.display = "none";
      }

      document
        .getElementById("registerForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const formData = {
            fullname: document.getElementById("fullname").value,
            email: document.getElementById("email").value,
            phoneNumber: document.getElementById("phoneNumber").value,
            haveSection: document.getElementById("haveSection").value,
            wantSection: document
              .getElementById("wantSection")
              .value.split(",")
              .map((s) => s.trim()),
          };

          try {
            const response = await fetch(`${API_BASE_URL}/register`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const result = await response.json();
            if (!response.ok) {
              const errorMessage = result.message || "Registration failed";
              if (
                errorMessage.includes("User with this email already exists")
              ) {
                throw new Error("User with this email already exists");
              } else if (
                errorMessage.includes(
                  "Input exceeds maximum length of 250 characters"
                )
              ) {
                throw new Error(
                  "Input exceeds maximum length of 250 characters"
                );
              } else if (errorMessage.includes("All fields are required")) {
                throw new Error("All fields are required");
              } else if (errorMessage.includes("Invalid phone number")) {
                throw new Error("Invalid phone number");
              } else if (errorMessage.includes("Invalid KIIT email address")) {
                throw new Error("Invalid KIIT email address");
              } else if (
                errorMessage.includes(
                  "wantSection needs to be a non-empty array"
                )
              ) {
                throw new Error("wantSection needs to be a non-empty array");
              } else if (
                errorMessage.includes(
                  "Invalid haveSection format. It should be like 'CSE2'"
                )
              ) {
                throw new Error(
                  "Invalid haveSection format. It should be like 'CSE2'"
                );
              } else if (
                errorMessage.includes(
                  "Something went wrong while registering the user"
                )
              ) {
                throw new Error(
                  "Something went wrong while registering the user"
                );
              } else {
                throw new Error("Registration failed. Please try again.");
              }
            }
            alert("User registered successfully");
            closeRegisterModal();
            loadInitialUsers(); // Refresh the user list
          } catch (error) {
            console.error("Error:", error);
            const errorMessage = `Registration may have failed due to the following errors:
1. Invalid phone number
2. Invalid KIIT email address
3. Email already registered.
4. Invalid haveSection format. It should be like 'CSE2'`;

            alert(errorMessage);
          }
        });

      // Initial load
      populateSectionDropdown();
      loadInitialUsers();
    </script>
  </body>
</html>
